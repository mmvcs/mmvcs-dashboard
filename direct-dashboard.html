<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MMVCS Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <h1>MMVCS Dashboard</h1>
        </header>
        
        <main class="dashboard-main">
            <div class="widgets-grid">
                <div class="widget-container full-width welcome-widget">
                    <h3></h3>
                    <div class="widget-frame">
                        <iframe src="https://dashboard.mmvcs-sales.com/caspio-widget-wrapper.html?widget=01217000f2c3610f806e481a9264" 
                                width="100%" height="600" frameborder="0" scrolling="auto"></iframe>
                    </div>
                </div>

                <div class="widget-container full-width">
                    <h3>Sales Comparison This Year vs. Last Year</h3>
                    <div class="widget-frame">
                        <iframe src="https://dashboard.mmvcs-sales.com/sales-comparison-wrapper.html" 
                                width="100%" height="600" frameborder="0" scrolling="auto"></iframe>
                    </div>
                </div>

                <div class="widget-container full-width">
                    <h3>Sales Chart by Month</h3>
                    <div class="widget-frame">
                        <iframe src="https://dashboard.mmvcs-sales.com/caspio-widget-wrapper.html?widget=0121700013fadbf0a2db4aca8f73" 
                                width="100%" height="600" frameborder="0" scrolling="auto"></iframe>
                    </div>
                </div>

                <div class="widget-container">
                    <h3>Support Tickets</h3>
                    <div class="widget-frame">
                        <iframe src="https://dashboard.mmvcs-sales.com/support-tickets-wrapper.html" 
                                width="100%" height="600" frameborder="0" scrolling="auto"></iframe>
                    </div>
                </div>

                <div class="widget-container">
                    <h3>Destination Mix - Last Year</h3>
                    <div class="widget-frame">
                        <iframe src="https://dashboard.mmvcs-sales.com/caspio-widget-wrapper.html?widget=01217000301880de360842d1adb1" 
                                width="100%" height="600" frameborder="0" scrolling="auto"></iframe>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Check for authentication credentials in URL
            const urlParams = new URLSearchParams(window.location.search);
            const authParam = urlParams.get('auth');
            
            if (authParam) {
                try {
                    // Decode credentials from URL
                    const decoded = atob(decodeURIComponent(authParam));
                    const [username, password] = decoded.split(':');
                    
                    if (username && password) {
                        // Store credentials for wrapper widgets
                        localStorage.setItem('mmvcs_user', username);
                        localStorage.setItem('mmvcs_pass', password);
                        sessionStorage.setItem('mmvcs_user', username);
                        sessionStorage.setItem('mmvcs_pass', password);
                        
                        // Clean URL to remove credentials
                        window.history.replaceState({}, document.title, window.location.pathname);
                        
                        console.log('Credentials stored for wrapper widgets:', username);
                        
                        // Show success message
                        showSuccessMessage();
                    }
                } catch (error) {
                    console.error('Error processing authentication:', error);
                }
            }
        });

        function showSuccessMessage() {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed; top: 20px; right: 20px; background: #27ae60; color: white; 
                padding: 15px; border-radius: 5px; z-index: 10000; max-width: 300px;
                box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            `;
            statusDiv.innerHTML = `
                ✅ <strong>Dashboard Loaded</strong><br>
                Using wrapper widgets for authentication
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: white; cursor: pointer; font-size: 16px;">×</button>
            `;
            document.body.appendChild(statusDiv);
            
            setTimeout(() => {
                if (document.body.contains(statusDiv)) {
                    document.body.removeChild(statusDiv);
                }
            }, 8000);
        }
    </script>
</body>
</html>